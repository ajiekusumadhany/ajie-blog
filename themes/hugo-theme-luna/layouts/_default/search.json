{{- $pages := where .Site.RegularPages "Type" "in" (slice "posts" "status") -}}
{{- $notHidden := where .Site.RegularPages "Params.hidden" "!=" true -}}
{{- $filtered := ($pages | intersect $notHidden) -}}

{{- $result := slice -}}

{{- range $filtered -}}
    {{- $data := dict 
        "title" .Title 
        "date" (.Date.Format "2006-01-01")
        "link" .RelPermalink 
        "content" (replaceRE "( )+?|\r?\n" " " (replaceRE "```(.|\n)+?```|{{.+?}}(.|\r?\n?)+?{{.+?}}|{{.+?}}|`(.+?)`" " " .RawContent | markdownify | plainify))
    -}}
    {{- $result = $result | append $data -}}
{{- end -}}

{{- jsonify $result -}}
